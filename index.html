<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>미학적 민감도 테스트(AReA)</title>
<style>
body{font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;margin:0;background:#f6f7fb;color:#0f172a;padding:20px;}
h1{font-size:20px;margin-bottom:20px;}

/* 문항 간격 넓게 */
form div{margin-bottom:20px;} 

label{font-weight:600;}

/* 선택지 가로 배치 */
form div > div {
  display: flex;
  flex-direction: row;
  gap: 12px;
  margin-top: 4px;
  flex-wrap: wrap;
}

/* 버튼 가로 정렬 유지 */
button{
  background:#334155;
  color:white;
  border:0;
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
  margin-top:10px;
  margin-right:8px; /* 버튼 간 가로 간격 */
}

#resultsArea{
  margin-top:20px;
  padding:10px;
  border:1px solid #eef2f7;
  border-radius:8px;
  background:#fbfcff;
}

.resultRow{margin-bottom:6px;}
.resultRow strong{margin-right:6px;}
canvas{margin-top:16px;}
</style>
</head>
<body>

<h1>미학적 민감도 테스트(AReA)</h1>

<form id="surveyForm"></form>
<button id="submitSurvey" type="button">제출</button>

<div id="resultsArea" style="display:none;">
  <div class="resultRow"><strong>각 항목 점수:</strong><span id="itemScores">—</span></div>
  <div class="resultRow"><strong>총합:</strong><span id="totalScore">—</span></div>
  <div class="resultRow"><strong>전체 평균:</strong><span id="meanScore">—</span></div>
  <div class="resultRow"><strong>AA 평균:</strong><span id="aaScore">—</span></div>
  <div class="resultRow"><strong>IAE 평균:</strong><span id="iaeScore">—</span></div>
  <div class="resultRow"><strong>CB 평균:</strong><span id="cbScore">—</span></div>
  <canvas id="scoreChart" width="400" height="200"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const surveyForm = document.getElementById('surveyForm');
const resultsArea = document.getElementById('resultsArea');
const submitSurvey = document.getElementById('submitSurvey');

// 14개 예시 항목
const items = [
{id:1,text:'나는 박물관을 방문하거나 음악/무용 공연을 보러 간다.',subscale:'AA',reverse:false},
{id:2,text:'나는 예술 작품을 볼 때 아름다움을 알아차린다.',subscale:'AA',reverse:false},
{id:3,text:'나는 음악에 의해 감정적으로 크게 움직인다.',subscale:'IAE',reverse:false},
{id:4,text:'예술 작품을 볼 때, 나는 그 조화로움에 감탄한다.',subscale:'AA',reverse:false},
{id:5,text:'나는 조각, 회화, 드로잉, 영화 연출 또는 디자인 작업을 한다.',subscale:'CB',reverse:false},
{id:6,text:'나는 예술 작품을 볼 때 긍정적인 에너지나 활력을 느낀다.',subscale:'IAE',reverse:false},
{id:7,text:'나는 시나 소설을 쓴다.',subscale:'CB',reverse:false},
{id:8,text:'나는 예술 작품을 볼 때 심장이 빨리 뛰거나, 땀이 나거나, 어지럽거나, 그 밖의 신체적 반응을 경험한다.',subscale:'IAE',reverse:false},
{id:9,text:'나는 건축물의 시각적 디자인을 감상한다.',subscale:'CB',reverse:false},
{id:10,text:'나는 현재(또는 과거에) 미술, 창작 글쓰기, 또는 미학 관련 수업을 듣고 있다(또는 들은 적이 있다).',subscale:'AA',reverse:false},
{id:11,text:'나는 예술 작품을 볼 때 경외감, 두려움, 혹은 압도되는 감정을 느낀다.',subscale:'IAE',reverse:false},
{id:12,text:'나는 예술 작품을 감상할 때 우주/자연/존재/신성과 하나가 된 듯한 일체감이나 연결감을 느낀다.',subscale:'IAE',reverse:false},
{id:13,text:'나는 예술 작품을 볼 때 깊이 감동받는다.',subscale:'AA',reverse:false},
{id:14,text:'나는 예술 작품을 볼 때 기쁨, 평온함, 또는 그 밖의 긍정적 감정을 경험한다.',subscale:'IAE',reverse:false}
];

// Chart.js 초기화
const ctx = document.getElementById('scoreChart').getContext('2d');
const scoreChart = new Chart(ctx,{
    type:'bar',
    data:{
        labels:['AA','IAE','CB'],
        datasets:[
            {label:'서브스케일 평균', data:[0,0,0], backgroundColor:['#3b82f6','#f97316','#10b981']},
            {label:'전체 평균', type:'line', data:[0,0,0], borderColor:'#facc15', borderWidth:2, fill:false, tension:0.1}
        ]
    },
    options:{
        indexAxis:'y', // 가로 막대
        responsive:true,
        scales:{x:{beginAtZero:true,max:5}},
        plugins:{legend:{position:'top'}}
    }
});

function updateChart(aa, iae, cb, overall){
    scoreChart.data.datasets[0].data=[aa, iae, cb];
    scoreChart.data.datasets[1].data=[overall,overall,overall];
    scoreChart.update();
}

function renderSurvey(){
    const min=1,max=5;
    items.forEach((it,i)=>{
        const div = document.createElement('div');
        const label = document.createElement('label');
        label.textContent = (i+1)+'. '+it.text;
        label.style.display='block';
        const row = document.createElement('div'); 
        row.style.display='flex'; 
        row.style.flexDirection='row';
        row.style.gap='12px';
        row.style.marginTop='6px';
        row.style.flexWrap='wrap';
        for(let v=min; v<=max; v++){
            const r = document.createElement('label'); 
            r.style.display='inline-flex'; 
            r.style.alignItems='center'; 
            r.style.gap='6px';
            const inp = document.createElement('input'); 
            inp.type='radio'; 
            inp.name='q'+i; 
            inp.value=v; 
            inp.required=true;
            r.appendChild(inp); 
            r.appendChild(document.createTextNode(v));
            row.appendChild(r);
        }
        div.appendChild(label); 
        div.appendChild(row);
        surveyForm.appendChild(div);
    });
}

function computeScores(resp){
    const min=1,max=5;
    const adjusted = resp.map((r,i)=>items[i].reverse ? (max+min)-r : r);
    document.getElementById('itemScores').textContent = adjusted.join(', ');
    const sum = adjusted.reduce((a,b)=>a+b,0);
    const overallMean = (sum/adjusted.length).toFixed(2);
    document.getElementById('totalScore').textContent = sum;
    document.getElementById('meanScore').textContent = overallMean;

    const groups={AA:[],IAE:[],CB:[]};
    items.forEach((it,i)=>{ if(groups[it.subscale]) groups[it.subscale].push(adjusted[i]); });
    const aaAvg = groups.AA.length ? (groups.AA.reduce((a,b)=>a+b,0)/groups.AA.length).toFixed(2) : 0;
    const iaeAvg = groups.IAE.length ? (groups.IAE.reduce((a,b)=>a+b,0)/groups.IAE.length).toFixed(2) : 0;
    const cbAvg = groups.CB.length ? (groups.CB.reduce((a,b)=>a+b,0)/groups.CB.length).toFixed(2) : 0;
    document.getElementById('aaScore').textContent = aaAvg;
    document.getElementById('iaeScore').textContent = iaeAvg;
    document.getElementById('cbScore').textContent = cbAvg;

    resultsArea.style.display='block';
    updateChart(Number(aaAvg), Number(iaeAvg), Number(cbAvg), Number(overallMean));
}

submitSurvey.addEventListener('click', ()=>{
    const formData = new FormData(surveyForm);
    const responses = [];
    let firstMissing = null;
    const allDivs = surveyForm.querySelectorAll('div');

    for(let i=0;i<items.length;i++){
        const val = formData.get('q'+i);
        if(!val && firstMissing===null) firstMissing=i;
        responses.push(val ? Number(val) : null);
    }

    if(firstMissing !== null){
        allDivs[firstMissing].scrollIntoView({behavior:'smooth', block:'center'});
        alert('모든 문항에 답해주세요!');
        return;
    }

    computeScores(responses);
});

renderSurvey();
</script>

</body>
</html>
